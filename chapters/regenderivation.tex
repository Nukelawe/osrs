\section{Derivation of the regenerative recurrence relations}\label{sect:regenRecurrenceDerivation}
First, consider fights that do not start at full hitpoints, i.e. $j < h$. Then
\begin{align}
	\langle L_{j-1} \rangle
		&= 1 + \sum_{i=1}^{j} p_{i,j-1}\langle L_i\rangle\nonumber\\
		&= 1 + \sum_{i=1}^{j-1} p_{i,j-1}\langle L_i\rangle + p_{j,j-1}\langle L_{j}\rangle\nonumber\\
	\implies p_{j,j-1}\langle L_{j}\rangle
		&= \langle L_{j-1} \rangle - 1 - \sum_{i=1}^{j-1} p_{i,j-1}\langle L_i\rangle\nonumber\\
		&= (1 - p_{j-1,j-1})\langle L_{j-1} \rangle - 1 - \sum_{i=1}^{j-2} p_{i,j-1}\langle L_i\rangle\nonumber\\
		&= 1 + \sum_{i=1}^{j} p_{ij}\langle L_i\rangle + p_{j+1,j}\left(1 + \sum_{i=1}^{j+2} p_{i,j+1}\langle L_i\rangle\right)\nonumber\\
		&= 1 + p_{j+1,j} + \sum_{i=1}^{j} p_{ij}\langle L_i\rangle + p_{j+1,j}\sum_{i=1}^{j+2} p_{i,j+1}\langle L_i\rangle\nonumber\\
		&= 1 + p_{j+1,j} + \sum_{i=1}^{j} \left(p_{ij} + p_{j+1,j}p_{i,j+1}\right)\langle L_i\rangle + p_{j+1,j}\sum_{i=j+1}^{j+2} p_{i,j+1}\langle L_i\rangle\nonumber\\
		&= 1 + p_{1j}\langle L_1 \rangle + \sum_{i=2}^{h-1} p_{ij}\langle L_i \rangle + p_{hj}\langle L_h\rangle\nonumber\\
		&= 1 + p_{1j}\langle L_1 \rangle + \sum_{i=2}^{h-1} p_{ij}\langle L_i \rangle + p_{hj}\langle L_h\rangle\nonumber\\
\end{align}
\begin{align}
    \langle L_h \rangle
		&= 1 + \sum_{i=1}^{h} p_{ih}\langle L_i\rangle\nonumber\\
		&= 1 + \sum_{i=1}^{j+1} p_{ij}\langle L_i\rangle\nonumber\\
		&= 1 + \sum_{i=1}^{j} p_{ij}\langle L_i\rangle + p_{j+1,j}\langle L_{j+1}\rangle\nonumber\\
		&= 1 + \sum_{i=1}^{j} p_{ij}\langle L_i\rangle + p_{j+1,j}\left(1 + \sum_{i=1}^{j+2} p_{i,j+1}\langle L_i\rangle\right)\nonumber\\
		&= 1 + p_{j+1,j} + \sum_{i=1}^{j} p_{ij}\langle L_i\rangle + p_{j+1,j}\sum_{i=1}^{j+2} p_{i,j+1}\langle L_i\rangle\nonumber\\
		&= 1 + p_{j+1,j} + \sum_{i=1}^{j} \left(p_{ij} + p_{j+1,j}p_{i,j+1}\right)\langle L_i\rangle + p_{j+1,j}\sum_{i=j+1}^{j+2} p_{i,j+1}\langle L_i\rangle\nonumber\\
		&= 1 + p_{1j}\langle L_1 \rangle + \sum_{i=2}^{h-1} p_{ij}\langle L_i \rangle + p_{hj}\langle L_h\rangle\nonumber\\
		&= 1 + p_{1j}\langle L_1 \rangle + \sum_{i=2}^{h-1} p_{ij}\langle L_i \rangle + p_{hj}\langle L_h\rangle\nonumber\\
\end{align}
Next we insert the damage roll probabilities. They depend on the max hit so once again we treat the two cases $h \leq m$ and $h>m$. Recall also that $L_1 = \frac{m+1}{am}$.\\
\textbf{Case} $h \leq m+1 \implies \Pr{X \geq h} = \frac{a}{m+1}(m-h+1)$.
\begin{align}
    \left(\frac{ma}{m+1} - \frac{\rho a}{m+1}\right)\L_h
	&= 1 + (1-\rho)\frac{a}{m+1}\L_1
	+ \sum_{i=2}^{h-1}\left((1-\rho)\frac{a}{m+1} + \rho\frac{a}{m+1}\right)\L_i\nonumber\\
    \implies (m - \rho)\L_h
	&= \frac{m+1}{a} + (1-\rho)\L_1 + \sum_{i=2}^{h-1} \L_i\nonumber
	= \frac{m+1}{a} - \rho\L_1 + \sum_{i=1}^{h-1} \L_i\nonumber\\
	&= \frac{m+1}{a} - \rho\frac{m+1}{ma} + \sum_{i=1}^{h-1} \L_i\nonumber
	= (m-\rho)\frac{m+1}{ma} + \sum_{i=1}^{h-1} \L_i\nonumber\\
	&= (m-\rho)\frac{m+1}{ma} + \sum_{i=1}^{\mathclap{(h-1)-1}} \L_i + \L_{h-1} \nonumber\\
    &= (m-\rho)\L_{h-1} + \L_{h-1} \nonumber\\
    \implies \L_h &= \frac{m-\rho+1}{m-\rho}\L_{h-1}
\end{align}
\textbf{Case} $h > m+1 \implies \Pr{X \geq h} = 0$
\begin{align}
    \left(\frac{ma}{m+1} - \frac{\rho a}{m+1}\right)\L_h
&= (1-\rho)\frac{a}{m+1}\sum_{i=h-m}^{h-1} (\L_i+1) + \rho\frac{a}{m+1}\sum_{i=h-m+1}^{h-1} (\L_i+1) + \left( 1 - \frac{ma}{m+1} + \frac{\rho a}{m+1}\right)\nonumber\\
    \implies (m-\rho)\L_h
    &= (1-\rho)\sum_{\mathclap{i=h-m}}^{h-1} (\L_i+1) + \rho\sum_{\mathclap{i=h-m+1}}^{h-1} (\L_i+1) + \frac{m+1}{a} - m + \rho\nonumber\\
    &= \sum_{\mathclap{i=h-m+1}}^{h-1} (\L_i+1) + (1-\rho)(\L_{h-m}+1) + \frac{m+1}{a} - m + \rho\nonumber\\
    &= \cancel{m} -\cancel{1} + \sum_{\mathclap{i=h-m+1}}^{h-1} \L_i + \L_{h-m} - \rho\L_{h-m} +\cancel{1} + \frac{m+1}{a} - \cancel{m}\nonumber\\
    &= m\L_1 - \rho\L_{h-m} + \sum_{\mathclap{i=h-m}}^{h-1} \L_i\nonumber\\
    &= m\L_1 - \rho\L_{h-m} + \sum_{\mathclap{i=(h-1)-m}}^{\mathclap{(h-1)-1}} \L_i - \rho\L_{h-m-1} + (\rho-1)\L_{h-m-1} + \L_{h-1}\nonumber\\
    &= (1 + m-\rho)\L_{h-1} - \rho\L_{h-m} + (\rho-1)\L_{h-m-1}\nonumber\\
    \implies \L_h &= \left(1 + \frac{1}{m-\rho}\right)\L_{h-1} - \left(\frac{\rho}{m-\rho}\L_{h-m} + \frac{1-\rho}{m-\rho}\L_{h-m-1}\right)\nonumber\\
\end{align}

